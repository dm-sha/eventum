# Реализация персональной iCalendar-подписки для участников

## Что было реализовано

### Бекенд (Django)

1. **Добавлена зависимость icalendar** в `requirements.txt`
2. **Создан endpoint** `/api/eventums/{eventum_slug}/calendar.ics` для генерации iCalendar файла
3. **Реализована логика фильтрации мероприятий** для конкретного участника:
   - Мероприятия для всех участников (`all`)
   - Мероприятия по записи (`registration`) - только если участник подал заявку
   - Мероприятия вручную (`manual`) - через прямое назначение, группы или теги групп
4. **Генерация iCalendar файла** с полной информацией о мероприятиях:
   - Название мероприятия
   - Время начала и окончания
   - Описание с локациями и тегами
   - Уникальные ID событий
   - Правильные заголовки HTTP для скачивания

### Фронтенд (React/TypeScript)

1. **Добавлена функция** `downloadParticipantCalendar()` в API клиент
2. **Создана иконка** `IconCalendarDownload` для кнопки скачивания
3. **Добавлена кнопка** "Скачать календарь" в компонент `EventCalendar`
4. **Реализована обработка ошибок** и индикация загрузки

## Как это работает

1. **Участник заходит** на страницу с календарем мероприятий
2. **Видит кнопку** "Скачать календарь" в заголовке
3. **Нажимает кнопку** - отправляется публичный запрос на бекенд без токена (используется только `participant_id`)
4. **Бекенд фильтрует** мероприятия для конкретного участника
5. **Генерируется iCalendar файл** с отфильтрованными мероприятиями
6. **Файл автоматически скачивается** в браузере пользователя

## Технические детали

- **Формат файла**: iCalendar (.ics) - стандартный формат для календарных приложений
- **Совместимость**: Работает с Google Calendar, Apple Calendar, Outlook и другими
- **Безопасность**: Доступ предоставляется по публичной ссылке на основании `participant_id`, токен аутентификации не используется
- **Производительность**: Оптимизированные запросы к базе данных с prefetch_related

## Тестирование

Создан тестовый скрипт `test_calendar_endpoint.py` который:
- Проверяет публичную доступность календаря без токена
- Запрашивает календарь для участника
- Сохраняет файл для проверки
- Показывает статистику генерации

## Результат

✅ **Полностью функциональная система** персональных календарных подписок
✅ **Интеграция с существующей системой** аутентификации и мероприятий  
✅ **Удобный интерфейс** для пользователей
✅ **Стандартный формат** для максимальной совместимости
